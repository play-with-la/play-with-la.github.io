<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/logo.png">
    <title>玩转线性代数</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- 自定义样式 -->
    <link href="css/style.css" rel="stylesheet">
</head>
<body class="theme-light">
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- 左侧功能区域 -->
            <div class="col-md-3 col-lg-3 sidebar p-0 d-flex">
                <!-- 垂直标签页导航 -->
                <div class="vertical-tabs-nav">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab">
                            <i class="bi bi-gear"></i>
                            <span>系统设置</span>
                        </button>
                        <button class="nav-link active" id="v-pills-vectors-tab" data-bs-toggle="pill" data-bs-target="#v-pills-vectors" type="button" role="tab">
                            <i class="bi bi-arrow-up-right"></i>
                            <span>向量管理</span>
                        </button>
                        <button class="nav-link" id="v-pills-matrices-tab" data-bs-toggle="pill" data-bs-target="#v-pills-matrices" type="button" role="tab">
                            <i class="bi bi-grid-3x3-gap"></i>
                            <span>矩阵管理</span>
                        </button>
                        <button class="nav-link" id="v-pills-shapes-tab" data-bs-toggle="pill" data-bs-target="#v-pills-shapes" type="button" role="tab">
                            <i class="bi bi-hexagon"></i>
                            <span>图案管理</span>
                        </button>
                        <button class="nav-link" id="v-pills-subspaces-tab" data-bs-toggle="pill" data-bs-target="#v-pills-subspaces" type="button" role="tab">
                            <i class="bi bi-boxes"></i>
                            <span>空间管理</span>
                        </button>
                        <button class="nav-link" id="v-pills-operations-tab" data-bs-toggle="pill" data-bs-target="#v-pills-operations" type="button" role="tab">
                            <i class="bi bi-lightning"></i>
                            <span>功能演示</span>
                        </button>

                        <!-- GitHub链接 -->
                        <a href="https://github.com/play-with-la" target="_blank" class="github-link" title="source code">
                            <i class="bi bi-github"></i>
                        </a>
                    </div>
                </div>
                
                <!-- 标签页内容区域 -->
                <div class="tab-content flex-grow-1" id="v-pills-tabContent">
                    <!-- 标签页1: 系统设置 -->
                    <div class="tab-pane fade" id="v-pills-settings" role="tabpanel">
                        <div class="tab-pane-content">
                            <h5 class="mb-3">系统设置</h5>
                            <!-- 颜色主题 -->
                            <div class="mb-2">
                                <label class="form-label">颜色主题</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="colorTheme" id="themeLight" value="light" checked>
                                    <label class="btn btn-outline-secondary rounded-0 rounded-start" for="themeLight">
                                        <i class="bi bi-sun"></i> 亮色
                                    </label>
                                    <input type="radio" class="btn-check" name="colorTheme" id="themeDark" value="dark">
                                    <label class="btn btn-outline-secondary rounded-0 rounded-end" for="themeDark">
                                        <i class="bi bi-moon"></i> 暗色
                                    </label>
                                </div>
                            </div>

                            <!-- 2D/3D切换 -->
                            <div class="mb-3">
                                <label class="form-label">显示模式</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="displayMode" id="mode2D" value="2D" checked>
                                    <label class="btn btn-outline-primary rounded-0 rounded-start" for="mode2D">2D</label>
                                    <input type="radio" class="btn-check" name="displayMode" id="mode3D" value="3D">
                                    <label class="btn btn-outline-primary rounded-0 rounded-end" for="mode3D">3D</label>
                                </div>
                            </div>
                            
                            <!-- 网格显示 -->
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showGrid" checked>
                                <label class="form-check-label" for="showGrid">显示网格</label>
                            </div>
                            
                            <!-- 坐标轴显示 -->
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="showAxes" checked>
                                <label class="form-check-label" for="showAxes">显示坐标轴</label>
                            </div>
                            
                            <!-- 坐标轴标签 (仅2D) -->
                            <div class="form-check form-switch mb-2" id="showLabelsSwitch">
                                <input class="form-check-input" type="checkbox" id="showLabels" checked>
                                <label class="form-check-label" for="showLabels">显示刻度标签</label>
                            </div>
                            
                            <!-- Z轴网格 (仅3D) -->
                            <div class="form-check form-switch mb-2" id="showZGridsSwitch" style="display: none;">
                                <input class="form-check-input" type="checkbox" id="showZGrids">
                                <label class="form-check-label" for="showZGrids">显示 Z 轴网格</label>
                            </div>
                            
                            <!-- 标准坐标轴网格面 (仅3D) -->
                            <div class="form-check form-switch mb-2" id="showAxisGridSurfaceSwitch" style="display: none;">
                                <input class="form-check-input" type="checkbox" id="showAxisGridSurface">
                                <label class="form-check-label" for="showAxisGridSurface">显示标准坐标轴网格面</label>
                            </div>
                            
                            <!-- 子空间网格面 (仅3D) -->
                            <div class="form-check form-switch mb-2" id="showSubspaceGridSurfaceSwitch" style="display: none;">
                                <input class="form-check-input" type="checkbox" id="showSubspaceGridSurface">
                                <label class="form-check-label" for="showSubspaceGridSurface">显示子空间网格面</label>
                            </div>
                            
                            <!-- 动画速度 -->
                            <div class="mb-3">
                                <label class="form-label">动画速度 (<span id="speedValue">1.0</span>x)</label>
                                <input type="range" class="form-range" id="animationSpeed" min="0.1" max="2" step="0.1" value="1">
                            </div>
                            
                            <!-- 重置视图按钮 -->
                            <div class="mb-3">
                                <button class="btn btn-outline-secondary w-100" id="resetViewBtn">
                                    <i class="bi bi-arrows-angle-contract"></i> 重置视图
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 标签页2: 向量管理 -->
                    <div class="tab-pane fade show active" id="v-pills-vectors" role="tabpanel">
                        <div class="tab-pane-content">
                            <h5 class="mb-3">向量管理</h5>
                        <div id="vectorInputContainer">
                            <!-- 2D向量输入 -->
                            <div id="vector2DInput">
                                <div class="row g-2 mb-2">
                                    <div class="col">
                                        <input type="number" class="form-control" id="vectorX" placeholder="x" value="1">
                                    </div>
                                    <div class="col">
                                        <input type="number" class="form-control" id="vectorY" placeholder="y" value="1">
                                    </div>
                                </div>
                            </div>
                            <!-- 3D向量输入 (默认隐藏) -->
                            <div id="vector3DInput" style="display: none;">
                                <div class="row g-2 mb-2">
                                    <div class="col">
                                        <input type="number" class="form-control" id="vectorX3D" placeholder="x" value="1">
                                    </div>
                                    <div class="col">
                                        <input type="number" class="form-control" id="vectorY3D" placeholder="y" value="1">
                                    </div>
                                    <div class="col">
                                        <input type="number" class="form-control" id="vectorZ3D" placeholder="z" value="1">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 向量颜色选择 -->
                            <div class="row g-2 mb-2 align-items-center">
                                <div class="col-auto">
                                    <label class="form-label mb-0">颜色 (可选)</label>
                                </div>
                                <div class="col">
                                    <input type="color" class="form-control form-control-color" id="vectorColor" value="#ff0000">
                                </div>
                                <div class="col">
                                    <input type="text" class="form-control" id="vectorName" placeholder="名称 (可选)" value="">
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-100 mb-2" id="addVectorBtn">
                            <i class="bi bi-plus-circle"></i> 添加向量
                        </button>
                        
                        <!-- 向量列表 -->
                        <div id="vectorList" class="vector-list mt-3">
                            <!-- 向量将动态添加到这里 -->
                        </div>
                        
                        <button class="btn btn-outline-danger w-100 mt-2" id="clearVectorsBtn">
                            <i class="bi bi-trash"></i> 清除所有向量
                        </button>
                        </div>
                    </div>
                    
                    <!-- 标签页3: 矩阵管理 -->
                    <div class="tab-pane fade" id="v-pills-matrices" role="tabpanel">
                        <div class="tab-pane-content">
                            <h5 class="mb-3">矩阵管理</h5>
                        <!-- 预置矩阵选择 -->
                        <div class="mb-2">
                            <label class="form-label mb-1"><small>预置矩阵:</small></label>
                            <select class="form-select form-select-sm" id="matrixPresetSelect">
                                <option value="">-- 选择预置矩阵 --</option>
                            </select>
                        </div>
                        
                        <!-- 2x2矩阵输入 -->
                        <div id="matrix2DInput">
                            <label class="form-label mb-1"><small>自定义矩阵:</small></label>
                            <div class="matrix-container mb-2">
                                <div class="matrix-bracket left"></div>
                                <div class="matrix-grid-2x2">
                                    <input type="number" class="form-control matrix-cell" id="m00" value="1" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m01" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m10" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m11" value="1" step="0.1">
                                </div>
                                <div class="matrix-bracket right"></div>
                            </div>
                        </div>
                        
                        <!-- 3x3矩阵输入 (默认隐藏) -->
                        <div id="matrix3DInput" style="display: none;">
                            <label class="form-label mb-1"><small>自定义矩阵:</small></label>
                            <div class="matrix-container mb-2">
                                <div class="matrix-bracket left"></div>
                                <div class="matrix-grid-3x3">
                                    <input type="number" class="form-control matrix-cell" id="m3d00" value="1" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d01" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d02" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d10" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d11" value="1" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d12" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d20" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d21" value="0" step="0.1">
                                    <input type="number" class="form-control matrix-cell" id="m3d22" value="1" step="0.1">
                                </div>
                                <div class="matrix-bracket right"></div>
                            </div>
                        </div>
                        
                        <!-- 矩阵名称输入 -->
                        <div class="row g-2 mb-2">
                            <div class="col">
                                <input type="text" class="form-control form-control-sm" id="matrixName" placeholder="名称 (可选)">
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-primary btn-sm" id="addMatrixBtn">
                                    <i class="bi bi-plus-circle"></i> 添加
                                </button>
                            </div>
                        </div>
                        
                        <!-- 矩阵列表 -->
                        <div id="matrixList" class="matrix-list mt-3">
                            <div class="text-muted text-center py-2">暂无矩阵</div>
                        </div>
                        
                        <!-- 矩阵运算 -->
                        <div class="mt-3 pt-3 border-top">
                            <label class="form-label mb-1"><small>矩阵运算:</small></label>
                            <select class="form-select form-select-sm mb-2" id="matrixOperationSelect">
                                <option value="" disabled selected>-- 选择运算 --</option>
                                <option value="add">矩阵加法 (A + B)</option>
                                <option value="subtract">矩阵减法 (A - B)</option>
                                <option value="scalar">标量乘法 (k × A)</option>
                                <option value="multiply2">矩阵乘法 (A × B)</option>
                                <option value="multiply3">矩阵乘法 (A × B × C)</option>
                            </select>
                            <div id="matrixOperationParams">
                                <!-- 根据选择的运算动态显示参数 -->
                            </div>
                            <button class="btn btn-success w-100 mt-2" id="executeMatrixOpBtn">
                                <i class="bi bi-calculator"></i> 计算
                            </button>
                            <div id="matrixOperationResult" class="mt-2" style="display: none;">
                                <!-- 运算结果 -->
                            </div>
                        </div>
                        
                        <button class="btn btn-outline-danger w-100 mt-3" id="clearMatricesBtn">
                            <i class="bi bi-trash"></i> 清除所有矩阵
                        </button>
                        </div>
                    </div>
                    
                    <!-- 标签页4: 图案管理 -->
                    <div class="tab-pane fade" id="v-pills-shapes" role="tabpanel">
                        <div class="tab-pane-content">
                            <h5 class="mb-3">图案管理</h5>
                            <!-- 3D预置图形选择 (仅3D模式显示) -->
                            <div id="shape3DPresets" style="display: none;">
                                <div class="mb-2">
                                    <label class="form-label mb-1"><small>预置图形:</small></label>
                                    <select class="form-select form-select-sm" id="shapePresetSelect">
                                        <option value="">-- 选择预置图形 --</option>
                                    </select>
                                </div>
                                
                                <!-- 图形参数配置区域 -->
                                <div id="shapeParamsContainer" style="display: none;">
                                    <div class="mb-2">
                                        <label class="form-label mb-1"><small>参数:</small></label>
                                        <div id="shapeParams">
                                            <!-- 动态生成的参数输入框 -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 图案颜色选择 -->
                                <div class="row g-2 mb-2 align-items-center">
                                    <div class="col-auto">
                                        <label class="form-label mb-0"><small>颜色:</small></label>
                                    </div>
                                    <div class="col">
                                        <input type="color" class="form-control form-control-color" id="shapeColor3D" value="#e74c3c">
                                    </div>
                                    <div class="col">
                                        <input type="text" class="form-control form-control-sm" id="shapeName3D" placeholder="名称 (可选)">
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2 mb-3">
                                    <button class="btn btn-primary flex-grow-1" id="addPresetShapeBtn">
                                        <i class="bi bi-plus-circle"></i> 添加预置图形
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 2D绘制图案区域 (仅2D模式显示) -->
                            <div id="shape2DDrawing">
                                <!-- 2D预置图形选择 -->
                                <div class="mb-2">
                                    <label class="form-label mb-1"><small>预置图形:</small></label>
                                    <select class="form-select form-select-sm" id="shapePresetSelect2D">
                                        <option value="">-- 选择预置图形 --</option>
                                    </select>
                                </div>
                                
                                <!-- 2D图形参数配置区域 -->
                                <div id="shapeParamsContainer2D" style="display: none;">
                                    <div class="mb-2">
                                        <label class="form-label mb-1"><small>参数:</small></label>
                                        <div id="shapeParams2D">
                                            <!-- 动态生成的参数输入框 -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 图案颜色选择 -->
                                <div class="row g-2 mb-2 align-items-center">
                                    <div class="col-auto">
                                        <label class="form-label mb-0">颜色 (可选)</label>
                                    </div>
                                    <div class="col">
                                        <input type="color" class="form-control form-control-color" id="shapeColor" value="#e74c3c">
                                    </div>
                                    <div class="col">
                                        <input type="text" class="form-control" id="shapeName" placeholder="名称 (可选)">
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2 mb-2">
                                    <button class="btn btn-primary flex-grow-1" id="addPresetShape2DBtn">
                                        <i class="bi bi-plus-circle"></i> 添加预置图形
                                    </button>
                                </div>
                                
                                <hr class="my-2">
                                
                                <button class="btn btn-outline-primary w-100 mb-2" id="startDrawShapeBtn">
                                    <i class="bi bi-pencil"></i> 手动绘制图案
                                </button>
                            </div>

                            <!-- 绘制状态提示 -->
                            <div id="shapeDrawingHint" class="alert alert-info py-2 mb-2" style="display: none;">
                                <small>
                                    <i class="bi bi-info-circle"></i> 
                                    在画布上点击添加点，双击或按 <kbd>Enter</kbd> 完成，<kbd>Esc</kbd> 取消
                                </small>
                            </div>
                            
                            <!-- 图案列表 -->
                            <div id="shapeList" class="shape-list mt-3">
                                <div class="text-muted text-center py-2">暂无图案</div>
                            </div>
                            
                            <button class="btn btn-outline-danger w-100 mt-2" id="clearShapesBtn">
                                <i class="bi bi-trash"></i> 清除所有图案
                            </button>
                        </div>
                    </div>
                    
                    <!-- 标签页5: 空间管理 -->
                    <div class="tab-pane fade" id="v-pills-subspaces" role="tabpanel">
                        <div class="tab-pane-content">
                            <h5 class="mb-3">空间管理</h5>
                            <!-- 添加子空间区域 -->
                            <div class="mb-3">
                                <label class="form-label"><small>选择基向量（点击选中/取消）</small></label>
                                <div class="basis-vector-select" id="subspaceVectorSelect">
                                    <!-- 动态生成的向量选项 -->
                                </div>
                                
                                <div class="row g-2 mb-2 align-items-center">
                                    <div class="col-auto">
                                        <input type="color" class="form-control form-control-color form-control-sm" id="subspaceColor" value="#ff6b6b">
                                    </div>
                                    <div class="col">
                                        <input type="text" class="form-control form-control-sm" id="subspaceName" placeholder="名称 (可选)">
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary w-100" id="addSubspaceBtn">
                                    <i class="bi bi-plus-circle"></i> 添加子空间
                                </button>
                                
                                <!-- 错误提示 -->
                                <div id="subspaceError" class="alert alert-danger py-1 mt-2" style="display: none;">
                                    <small></small>
                                </div>
                            </div>
                            
                            <!-- 子空间列表 -->
                            <div id="subspaceList" class="subspace-list">
                                <div class="text-muted text-center py-2">暂无子空间</div>
                            </div>
                            
                            <button class="btn btn-outline-danger w-100 mt-2" id="clearSubspacesBtn">
                                <i class="bi bi-trash"></i> 清除所有子空间
                            </button>
                        </div>
                    </div>
                    
                    <!-- 标签页6: 功能演示 -->
                    <div class="tab-pane fade" id="v-pills-operations" role="tabpanel">
                        <div class="tab-pane-content">
                            <h5 class="mb-3">功能演示</h5>
                        <select class="form-select mb-2" id="operationSelect">
                            <!-- 操作选项由JavaScript动态生成 -->
                        </select>
                        
                        <!-- 操作参数区域 -->
                        <div id="operationParams" class="mb-2">
                            <!-- 根据选择的操作动态显示参数输入 -->
                        </div>
                        
                        <button class="btn btn-success w-100" id="executeOperationBtn">
                            <i class="bi bi-play-circle"></i> 执行操作
                        </button>
                        
                        <!-- 结果显示区域 -->
                        <div id="operationResult" class="mt-3 result-display" style="display: none;">
                            <!-- 操作结果将显示在这里 -->
                        </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 中间显示区域 -->
            <div class="col-md-9 col-lg-9 main-display p-0">
                <!-- 2D Canvas -->
                <canvas id="canvas2D" class="visualization-canvas"></canvas>
                <!-- 3D Container (Three.js) -->
                <div id="container3D" class="visualization-canvas" style="display: none;"></div>
                
                <!-- 信息提示区域 -->
                <div id="infoOverlay" class="info-overlay">
                    <span id="cursorCoords">坐标: (0, 0)</span>
                </div>
                
                <!-- 控制提示 -->
                <div id="controlsHint" class="controls-hint">
                    <small>
                        <span id="hint2D">拖拽向量端点移动向量 | 拖拽空白区域平移视图 | 滚轮缩放</span>
                        <span id="hint3D" style="display: none;">鼠标拖拽: 旋转视图 | 滚轮: 缩放 | 右键拖拽: 平移</span>
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 全局矩阵提示框 -->
    <div id="matrixTooltip"><pre></pre></div>
    
    <!-- Import Map for Three.js ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Math.js -->
    <script src="https://cdn.jsdelivr.net/npm/mathjs@12.2.1/lib/browser/math.min.js"></script>
    <!-- MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- 自定义模块 -->
    <script src="js/vector.js"></script>
    <script src="js/matrix.js"></script>
    <script src="js/shape.js"></script>
    <script src="js/subspace.js"></script>
    <script src="js/operations.js"></script>
    <!-- 可视化模块（已拆分） -->
    <script src="js/renderer2d.js"></script>
    <!-- Three.js 和 3D 渲染器使用 ES Modules -->
    <script type="module" src="js/renderer3d.js"></script>
    <script type="module" src="js/visualization.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
